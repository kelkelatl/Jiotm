name: Android CI - Build APK

# 1. Trigger the workflow
on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]
  # Allows you to run the workflow manually from the GitHub Actions tab
  workflow_dispatch:

# 2. Define the jobs (what to do)
jobs:
  build:
    runs-on: ubuntu-latest
    
    # Define the environment variables for SDK and build tools
    env:
      # Use a recent Android SDK version
      ANDROID_SDK_ROOT: ${{ github.workspace }}/.android/sdk
      ANDROID_BUILD_TOOLS: 34.0.0 # Match your targetSdk from build.gradle.kts
      
    steps:
      # a. Checkout the code
      - name: Checkout Repository
        uses: actions/checkout@v4

      # b. Set up Java Environment
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17' # Match the JVM target from build.gradle.kts
          distribution: 'temurin'
          cache: 'gradle' # Cache Gradle dependencies for faster builds

      # c. Make gradlew executable (standard procedure on Linux runners)
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # d. Build the Debug APK
      # The 'assembleDebug' task builds a debug APK which is fine for CI/testing
      - name: Build Debug APK
        run: ./gradlew assembleDebug

      # e. Upload the resulting APK as a workflow artifact
      # This allows you to download the APK directly from the GitHub Actions run summary.
      - name: Upload Debug APK Artifact
        uses: actions/upload-artifact@v4
        with:
          # The path to your built APK (adjust if your module name is different)
          path: app/build/outputs/apk/debug/app-debug.apk
          name: Emoticon-App-Debug-APK
          retention-days: 5 # How long to keep the artifact
